<!DOCTYPE html>
<html lang="en">
<head>
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<!--Import Google Icon Font-->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<!--Import materialize.css-->
<link type="text/css" rel="stylesheet" href="../../static/css/materialize.min.css"  media="screen,projection"/>

<!--Let browser know website is optimized for mobile-->
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>

<body>
    <div class="container">
        <h1>Open Registry</h1>
        <br>
        <form id="form">
            <div class="input-field">
                <!-- <label for="content_URL">Content URL</label> -->
                <h5>Content URL</h5>
                <input id="content_URL" type="text" name="url" placeholder="Paste your content URL here." required
                    pattern="https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)">
            </div>
            <div>
                <h5>Categories</h5>
                <p>Select which categories the content belongs to.</p>
                <p>
                    <label for="0001">
                    <input id="0001" name="category" type="checkbox" value="Leadership" />
                    <span>Leadership</span>
                    </label>
                </p>
                <p>
                    <label for="0002">
                    <input id="0002" name="category" type="checkbox" value="Design"/>
                    <span>Design</span>
                    </label>
                </p>
                <p>
                    <label for="0003">
                    <input id="0003" name="category" type="checkbox" value="Data Analysis"/>
                    <span>Data Analysis</span>
                    </label>
                </p>
                <p>
                    <label for="0004">
                    <input id="0004" name="category" type="checkbox" value="Digital Government"/>
                    <span>Digital Government</span>
                    </label>
                </p>
                <p>
                    <label for="0005">
                    <input id="0005" name="category" type="checkbox" value="AI / Machine Learning"/>
                    <span>AI / Machine Learning</span>
                    </label>
                </p>
                <p>
                    <label for="0006">
                    <input id="0006" name="category" type="checkbox" value="DevOps"/>
                    <span>DevOps</span>
                    </label>
                </p>
            </div>
            <button id="btnSubmit" class="btn waves-effect" type="submit">Submit</button>
        </form>
        <!-- <button id="btnSubmit" class="btn waves-effect">Submit</button> -->
    </div>

<!--JavaScript at end of body for optimized loading-->
<script type="text/javascript" src="../../static/js/materialize.min.js"></script>
<script type="text/javascript">

(function ($) {
    $(function () {
        // function postData(url, data) {
        //     return fetch(url, {
        //         method: "POST",
        //         headers: {
        //             "Content-Type": "application/json",
        //         },
        //         body: JSON.stringify(data),
        //     }).then(response => response.json());
        // }

        // From https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch
        function postData(url, data) {
            return fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
            }).then(response => {
                if (response.ok) {
                    return response.json()
                }
            });
        }


        function submitContent() {
            var url = $("#content_URL").val();
            // List the values of every checked box with the name 'category'
            var categories = [];
            $.each($("input[name='category']:checked"), function() {
                categories.push($(this).val());
            })
            // 
            // postData('http://localhost:5000/submit', {
            postData('http://localhost:5000', {
                "url": url,
                "categories": categories
            })
            // Is 'payload' the right term?
            .then(data => {
                var payload = JSON.stringify(data);
                alert(payload);
                console.log(payload);
            })
            .catch(error => console.error(error));
            // .then(data => alert(JSON.stringify(data)))
            // .then(data => console.log(JSON.stringify(data)))
            // .catch(error => console.error(error));
            // document.getElementById("form").reset();
        }

        function clearForm() {
            document.getElementById("form").reset();
        }

        $("#btnSubmit").on("click",function(){
            submitContent();
        });
    });
})(jQuery);


</script>
</body>
</html>



<!-- 
    Issues:
    
    I can't use basic HTML5 built-in validation without the use of a <form>, BUT
    if I use a <form>, the request's body get added to the URL and also causes the
    alert to only work every two times. 
 -->